<!DOCTYPE html>
];
return lines.join('
');
}


function openModal(summary){
$('#previewText').textContent = summary;
const dialog = $('#previewModal');
if(typeof dialog.showModal === 'function') dialog.showModal(); else alert(summary);
}
function closeModal(){ $('#previewModal').close(); }


function copySummary(){
const txt = $('#previewText').textContent;
navigator.clipboard.writeText(txt).then(()=>{
alert('Summary copied to clipboard.');
});
}


function mailtoLink(body){
const to = 'orders@yourcatering.com'; // TODO: replace with your inbox
const subject = encodeURIComponent('New Catering Request');
const b = encodeURIComponent(body);
return `mailto:${to}?subject=${subject}&body=${b}`;
}


async function tryFormspree(payload){
if(!FORMSPREE_URL) return false;
try{
const res = await fetch(FORMSPREE_URL,{
method:'POST',
headers:{'Accept':'application/json','Content-Type':'application/json'},
body: JSON.stringify(payload)
});
if(res.ok){ alert('Submitted! We\'ll be in touch shortly.'); return true; }
else{ const t = await res.text(); alert('Submit error: '+t); return false; }
}catch(err){ console.error(err); alert('Network error submitting form.'); return false; }
}


async function tryEmailJS(payload){
if(!(window.emailjs && EMAILJS_PUBLIC_KEY && EMAILJS_SERVICE_ID && EMAILJS_TEMPLATE_ID)) return false;
try{
emailjs.init(EMAILJS_PUBLIC_KEY);
const r = await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, payload);
if(r && r.status === 200){ alert('Submitted! Check your email.'); return true; }
return false;
}catch(e){ console.error(e); alert('EmailJS error.'); return false; }
}


form.addEventListener('submit', async (e)=>{
e.preventDefault();
if(!requiredFilled() || !validateTimes()) return;
const obj = serialize();
const pretty = prettySummary(obj);
openModal(pretty);


const payload = { ...obj, pretty_summary: pretty, line_summary: lineSummary(obj) };
const sendBtn = $('#sendBtn');
sendBtn.onclick = async ()=>{
// Try direct send via Formspree or EmailJS. If not configured, fall back to mailto
if(await tryFormspree(payload)) return;
if(await tryEmailJS(payload)) return;
// Fallback to email client with line-by-line formatted body
window.location.href = mailtoLink(payload.line_summary);
};
});


$('#copyBtn').addEventListener('click', ()=>{
if(!requiredFilled()) return;
const summary = prettySummary(serialize());
navigator.clipboard.writeText(summary).then(()=> alert('Summary copied.'));
});


$('#printBtn').addEventListener('click', ()=> window.print());
</script>
</body>
</html>
