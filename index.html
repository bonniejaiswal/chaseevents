<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JPMC Catering & Event Request</title>
  <meta name="description" content="Submit a catering request with event details, menu preferences, and budget." />
  <style>
    :root{
      /* Brandable palette */
      --bg:#fef1ff; /* requested soft backdrop */
      --card:#ffffff;
      --muted:#5b6674;
      --text:#0f1222;
      --accent:#6f5cf1;
      --accent2:#29b385;
      --danger:#ff5a5f;
      --border:#e5e8ef;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg)}
    .container{max-width:980px;margin:40px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;box-shadow:0 10px 30px rgba(20,20,20,.06);overflow:hidden}

    header.hero{padding:24px;border-bottom:1px solid var(--border);display:flex;gap:16px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;gap:14px;align-items:center}
    .logo{width:42px;height:42px;border-radius:10px;background:radial-gradient(120px 60px at 30% 30%,var(--accent),transparent 60%),radial-gradient(120px 60px at 70% 70%,var(--accent2),transparent 60%);border:1px solid rgba(0,0,0,.06)}
    h1{color:var(--text);margin:0;font-size:1.4rem;letter-spacing:.3px}
    .sub{color:var(--muted);font-size:.95rem}

    form{padding:24px;display:grid;grid-template-columns:1fr;gap:18px}
    @media(min-width:700px){
      form{grid-template-columns:repeat(12,1fr)}
      .span-12{grid-column:span 12}
      .span-6{grid-column:span 6}
      .span-4{grid-column:span 4}
      .span-3{grid-column:span 3}
      .span-8{grid-column:span 8}
      .row{grid-template-columns:1fr 1fr}
      .actions{flex-direction:row}
      .actions button{width:auto}
      .totals{flex-direction:row}
      .summary{min-width:260px}
    }

    fieldset{border:1px solid var(--border);border-radius:14px;padding:16px;margin:0}
    legend{padding:0 8px;color:var(--muted);font-size:.95rem}

    label{display:block;color:var(--text);font-weight:600;margin-bottom:6px}
    .hint{color:var(--muted);font-size:.85rem;margin-top:6px}

    input[type="text"],input[type="email"],input[type="tel"],input[type="number"],input[type="date"],input[type="time"],textarea,select{
      width:100%;padding:12px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;color:var(--text);outline:none;transition:box-shadow .15s,border-color .15s
    }
    textarea{min-height:110px;resize:vertical}
    input:focus,select:focus,textarea:focus{box-shadow:0 0 0 3px rgba(111,92,241,.15);border-color:#cfd6ff}

    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}

    /* Compact, consistent chips for radios/checkboxes */
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#fff;color:var(--text);cursor:pointer;user-select:none;line-height:1}
    .chip input{accent-color:var(--accent)}

    .totals{display:flex;gap:16px;flex-wrap:wrap}
    .summary{flex:1;min-width:260px;border:1px dashed var(--border);border-radius:12px;padding:12px;color:var(--text);background:#fff}
    .summary h3{margin:.2rem 0 .6rem;font-size:1rem;color:var(--muted)}

    .actions{display:flex;gap:12px;flex-wrap:wrap}
    button{appearance:none;border:none;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer}
    .primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:white}
    .ghost{background:transparent;color:var(--text);border:1px solid var(--border)}
    .danger{background:var(--danger);color:white}
    .success{background:#20c997;color:white}

    .footer{padding:18px 24px;border-top:1px solid var(--border);display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;color:var(--muted);font-size:.9rem}

    /* Modal */
    dialog{border:none;border-radius:16px;background:#fff;color:var(--text);width:min(720px,92vw);box-shadow:0 10px 40px rgba(0,0,0,.15)}
    dialog::backdrop{background:rgba(0,0,0,.35)}
    .modal-head{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);padding:14px 16px}
    .modal-body{padding:16px}
    .modal-actions{display:flex;gap:10px;justify-content:flex-end;padding:16px;border-top:1px solid var(--border)}
    pre{white-space:pre-wrap;background:#fafbff;border:1px solid var(--border);border-radius:12px;padding:12px}

    .required::after{content:" *";color:var(--danger);font-weight:700}
    
    /* Mobile-first tweaks */
    .row{grid-template-columns:1fr}
    .actions{flex-direction:column}
    .actions button{width:100%}
    .container{margin:24px auto}
    .totals{flex-direction:column}
    .summary{min-width:100%}
    .restaurant-list{max-height:260px;overflow:auto;border:1px solid var(--border);border-radius:10px;background:#fff}
    .restaurant-item{padding:10px 12px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;gap:12px;cursor:pointer}
    .restaurant-item:last-child{border-bottom:none}
    .restaurant-item[aria-selected="true"]{background:rgba(111,92,241,.08);outline:2px solid rgba(111,92,241,.25)}
    .restaurant-name{color:var(--text);font-weight:600}
    .restaurant-cuisine{color:var(--muted);font-size:.9rem}
    
    /* Desktop overrides placed after mobile-first rules */
    @media(min-width:700px){
      .row{grid-template-columns:1fr 1fr}
      .actions{flex-direction:row}
      .actions button{width:auto}
      .totals{flex-direction:row}
      .summary{min-width:260px}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <header class="hero">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <h1>JPMC Catering & Event Request</h1>
            <div class="sub">Tell us the basics. We‚Äôll confirm with a custom proposal.</div>
          </div>
        </div>
        <div class="sub">üìû <a href="tel:+14088874511" style="color:var(--accent);text-decoration:none">+1 (408) 887‚Äë4511</a> ¬∑ ‚úâÔ∏è <a href="mailto:Jarlein.Escobar@fooda.com" style="color:var(--accent);text-decoration:none">Jarlein.Escobar@fooda.com</a></div>
      </header>

      <form id="cateringForm" novalidate>
        <!-- Contact Information -->
        <fieldset class="span-12">
          <legend>Contact</legend>
          <div class="row">
            <div>
              <label for="name" class="required">Name</label>
              <input id="name" name="name" type="text" autocomplete="name" required />
            </div>
            <div>
              <label for="email" class="required">Email</label>
              <input id="email" name="email" type="email" autocomplete="email" required />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="phone" class="required">Phone</label>
              <input id="phone" name="phone" type="tel" autocomplete="tel" required />
            </div>
            <div>
              <label for="company">Company / Organization</label>
              <input id="company" name="company" type="text" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="costCenter">Cost Center</label>
              <input id="costCenter" name="costCenter" type="text" placeholder="Optional" />
            </div>
            <div></div>
          </div>
        </fieldset>

        <!-- Event Details -->
        <fieldset class="span-12">
          <legend>Event Details</legend>
          <div class="row">
            <div>
              <label for="eventDate" class="required">Event Date</label>
              <input id="eventDate" name="eventDate" type="date" required />
            </div>
            <div>
              <label for="location" class="required">Location</label>
              <input id="location" name="location" type="text" placeholder="Building, Floor No, Meeting room" required />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="startTime" class="required">Start Time</label>
              <input id="startTime" name="startTime" type="time" step="900" required />
            </div>
            <div>
              <label for="endTime" class="required">End Time</label>
              <input id="endTime" name="endTime" type="time" step="900" required />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="guests" class="required">Estimated Guest #</label>
              <input id="guests" name="guests" type="number" min="1" step="1" required />
            </div>
            <div>
              <label for="serviceStyle" class="required">Service Style</label>
              <select id="serviceStyle" name="serviceStyle" required>
                <option value="" disabled selected>Select‚Ä¶</option>
                <option>Disposable</option>
                <option>China</option>
              </select>
            </div>
          </div>
        </fieldset>

        <!-- Meal Preferences -->
        <fieldset class="span-12">
          <legend>Meal Preferences</legend>
          <label class="required">Type of Service (select all that apply)</label>
          <div class="chips" role="group" aria-label="Meal types">
            <label class="chip"><input type="checkbox" name="mealTypes" value="Breakfast"> Breakfast</label>
            <label class="chip"><input type="checkbox" name="mealTypes" value="Lunch"> Lunch</label>
            <label class="chip"><input type="checkbox" name="mealTypes" value="Snacks"> Snacks</label>
            <label class="chip"><input type="checkbox" name="mealTypes" value="Appetizers"> Appetizers</label>
            <label class="chip"><input type="checkbox" name="mealTypes" value="Dinner"> Dinner</label>
          </div>
          <div style="margin-top:14px" class="row">
            <div>
              <label class="required">Menu Preference</label>
              <div class="chips" role="radiogroup" aria-label="Menu">
                <label class="chip"><input type="radio" name="menuPref" value="Preferred Menu" required> Preferred Menu (describe below)</label>
                <label class="chip"><input type="radio" name="menuPref" value="Open to Suggestions" required> Open to Suggestions</label>
              </div>
              <textarea id="menuNotes" name="menuNotes" placeholder="Dietary preferences, cuisine ideas, must‚Äëhaves"></textarea>
            </div>
            <div>
              <label class="required">Catering Type</label>
              <div class="chips" role="radiogroup" aria-label="Catering type">
                <label class="chip"><input type="radio" name="cateringType" value="Regular" required> Regular</label>
                <label class="chip"><input type="radio" name="cateringType" value="VIP" required> VIP</label>
              </div>
            </div>
          </div>

          <!-- Approved Restaurants Selector -->
          <div class="span-12" style="margin-top:14px">
            <fieldset>
              <legend>Approved Restaurants</legend>
              <div class="row">
                <div>
                  <label for="restaurantSearch">Search by Name</label>
                  <input id="restaurantSearch" type="text" placeholder="Start typing a restaurant name" />
                </div>
                <div>
                  <label for="cuisineFilter">Filter by Cuisine</label>
                  <select id="cuisineFilter">
                    <option value="">All cuisines</option>
                  </select>
                </div>
              </div>
              <div style="margin-top:10px">
                <label>Select Restaurant</label>
                <div id="restaurantList" class="restaurant-list" role="listbox" aria-label="Approved Restaurants"></div>
                <input type="hidden" id="restaurantValue" name="restaurant" />
                <input type="hidden" id="restaurantCuisineValue" name="restaurantCuisine" />
                <div class="hint">Tap to select. Use search and filter above.</div>
              </div>
            </fieldset>
          </div>
        </fieldset>

        <!-- Budget -->
        <fieldset class="span-12">
          <legend>Budget</legend>
          <div class="row">
            <div>
              <label for="budgetPer" class="required">Budget per Person (USD)</label>
              <input id="budgetPer" name="budgetPer" type="number" min="0" step="0.01" required />
              <div class="hint">We‚Äôll propose options within this range.</div>
            </div>
            <div>
              <label for="totalBudget">Total Budget (USD)</label>
              <input id="totalBudget" name="totalBudget" type="number" min="0" step="0.01" />
              <div class="hint">Optional. If left blank, we‚Äôll estimate from guests √ó per‚Äëperson.</div>
            </div>
          </div>
          <div class="row">
            <div>
              <label class="chip"><input type="checkbox" id="rush" name="rush"> Last‚ÄëMinute Event (within 48 hrs) ‚Äî <strong>$200 rush fee</strong></label>
            </div>
            <div></div>
          </div>
          <div class="totals">
            <div class="summary">
              <h3>Live Estimate</h3>
              <div id="estimateLines">
                <div>Guests √ó Per‚Äëperson: <strong id="calcBase">‚Äî</strong></div>
                <div>Rush Fee: <strong id="calcRush">‚Äî</strong></div>
                <div style="margin-top:6px">Estimated Total: <strong id="calcTotal">‚Äî</strong></div>
              </div>
              <div class="hint">For guidance only. Final quote follows after we review your request.</div>
            </div>
          </div>
        </fieldset>

        <!-- Notes -->
        <fieldset class="span-12">
          <legend>Additional Notes</legend>
          <textarea id="notes" name="notes" placeholder="Setup needs, onsite staff, allergies, rentals, timeline, etc."></textarea>
        </fieldset>

        <!-- Actions -->
        <div class="span-12 actions">
          <button class="primary" type="submit">Preview & Send</button>
          <button class="ghost" type="button" id="copyBtn">Copy Summary</button>
          <button class="ghost" type="button" id="printBtn">Print / Save PDF</button>
          <button class="danger" type="reset">Clear</button>
        </div>
      </form>

      <div class="footer">
        <div>¬© <span id="year"></span> Your Catering Co.</div>
        <div>By submitting, you agree to be contacted about your event.</div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <dialog id="previewModal" aria-labelledby="modaltitle">
    <div class="modal-head">
      <strong id="modaltitle">Request Preview</strong>
      <button class="ghost" onclick="closeModal()">Close</button>
    </div>
    <div class="modal-body">
      <pre id="previewText"></pre>
    </div>
    <div class="modal-actions">
      <button class="ghost" onclick="copySummary()">Copy</button>
      <button class="success" id="mailtoBtn">Email Request</button>
      <button class="primary" onclick="window.print()">Print / Save PDF</button>
    </div>
  </dialog>

  <script>
    const $ = sel => document.querySelector(sel);
    const $$ = sel => [...document.querySelectorAll(sel)];

    // Set min date to today and current year
    const today = new Date();
    const yyyy = today.getFullYear();
    $('#year').textContent = yyyy;
    const pad = n => String(n).padStart(2,'0');
    const minDate = `${yyyy}-${pad(today.getMonth()+1)}-${pad(today.getDate())}`;
    $('#eventDate').setAttribute('min', minDate);

    const form = $('#cateringForm');
    const rush = $('#rush');
    const guests = $('#guests');
    const budgetPer = $('#budgetPer');
    const totalBudget = $('#totalBudget');
    const calcBase = $('#calcBase');
    const calcRush = $('#calcRush');
    const calcTotal = $('#calcTotal');
    const startTime = document.getElementById('startTime');
    const endTime = document.getElementById('endTime');

    // Restaurants dataset (approved list)
    const approvedRestaurants = [
      { name: "Aina's Vegan", cuisine: 'Vietnamese' },
      { name: 'Alamar', cuisine: 'Seafood' },
      { name: 'Arepas', cuisine: 'Latin American' },
      { name: 'Aroma House', cuisine: 'Indian' },
      { name: 'Bayshore Taqueria', cuisine: 'Mexican' },
      { name: 'Beyond the Border', cuisine: 'Latin American' },
      { name: 'Bistro Bites', cuisine: 'Vietnamese/French' },
      { name: 'Bonchon - Blossom Hill Rd', cuisine: 'Korean/Fried Chicken' },
      { name: 'Bravo! House of Enchiladas', cuisine: 'Mexican' },
      { name: 'Bun Me Up', cuisine: 'Chinese/Breakfast' },
      { name: 'Buri Buri Bento', cuisine: 'Japanese' },
      { name: 'Burma Classic - San Francisco', cuisine: 'Burmese' },
      { name: "C'era Una Volta", cuisine: 'Italian' },
      { name: "Chef Jimmy's Catering", cuisine: 'Mediterranean' },
      { name: 'Experience Burma', cuisine: 'Burmese' },
      { name: 'Flamb√©', cuisine: 'Asian' },
      { name: 'Flaming Ox', cuisine: 'Taiwanese' },
      { name: 'Ginza Eats', cuisine: 'Poke' },
      { name: 'Gyro Xpress', cuisine: 'Mediterranean' },
      { name: "Hana's Cafe", cuisine: 'American/Salad/Deli/Mexican' },
      { name: 'Himalayan Chef & Kitchen', cuisine: 'Indian' },
      { name: 'Hongry Kong', cuisine: 'Chinese' },
      { name: 'I Love Cheesesteak', cuisine: 'American' },
      { name: 'Jalsa Catering & Events', cuisine: 'Indian' },
      { name: 'Japafood', cuisine: 'Japanese' },
      { name: "Kawashima's Kitchen", cuisine: 'Japanese' },
      { name: 'Koja Kitchen - Dublin', cuisine: 'Korean' },
      { name: 'Koja Kitchen - Fremont', cuisine: 'Korean' },
      { name: 'Koja-Viet Delight', cuisine: 'Vietnamese' },
      { name: 'L.B. Taqueria', cuisine: 'Mexican' },
      { name: "Liang's Village", cuisine: 'Taiwanese' },
      { name: 'Lima Peruvian Food', cuisine: 'Peruvian' },
      { name: 'Little Green Cyclo', cuisine: 'Vietnamese' },
      { name: 'Locali Mediterranean', cuisine: 'Mediterranean' },
      { name: 'Loving Hut', cuisine: 'Vegan' },
      { name: "Max's of Manila - South SF", cuisine: 'Filipino' },
      { name: 'Mint Leaf', cuisine: 'Vietnamese' },
      { name: 'Miss Subi', cuisine: 'Asian' },
      { name: 'Momo & Kebab', cuisine: 'Indian' },
      { name: "Nina's Taqueria", cuisine: 'Mexican' },
      { name: 'Noor Indian Fusion Kitchen - Oakland', cuisine: 'Indian' },
      { name: 'Papas & Eggs', cuisine: 'Breakfast' },
      { name: "Pia's Thai Kitchen", cuisine: 'Thai' },
      { name: 'Picnic Basket', cuisine: 'Poke/Deli' },
      { name: 'Proposition Chicken (OAK)', cuisine: 'American' },
      { name: 'Proposition Chicken (SF)', cuisine: 'American' },
      { name: 'Pushcart Fare', cuisine: 'Chinese' },
      { name: 'Red Chillies', cuisine: 'Indian' },
      { name: "Romano's Macaroni Grill", cuisine: 'Italian' },
      { name: 'Sajj Mediterranean - San Mateo', cuisine: 'Mediterranean' },
      { name: 'Salsa Picante - Fremont', cuisine: 'Mexican' },
      { name: 'SB Catering & Events', cuisine: 'Mexican/Asian' },
      { name: 'Seoul Eats', cuisine: 'Korean' },
      { name: 'Smoked Out BBQ', cuisine: 'Barbecue' },
      { name: "SSB Catering (Achiote Grill)", cuisine: 'Cuban/Jamaican' },
      { name: "SSB Catering (Breakfast Bistro)", cuisine: 'Breakfast' },
      { name: "SSB Catering (Graziano's)", cuisine: 'Italian' },
      { name: "SSB Catering (Lunchly)", cuisine: 'American' },
      { name: "SSB Catering (Shoyu)", cuisine: 'Asian' },
      { name: 'Straw Hat Pizza', cuisine: 'Pizza' },
      { name: 'Sugo', cuisine: 'Italian' },
      { name: 'Superfine Kitchen', cuisine: 'Salad/Deli/Japanese/Indian/Mexican/Breakfast' },
      { name: 'Sweet Fingers', cuisine: 'Jamaican' },
      { name: 'Tannourine', cuisine: 'Mediterranean' },
      { name: 'The Gurkha Kitchen - Hayward', cuisine: 'Indian' },
      { name: 'The Gurkha Kitchen - Sunnyvale', cuisine: 'Indian' },
      { name: 'The Kebab Guys', cuisine: 'Mediterranean' },
      { name: 'The Lightbox Caf√©', cuisine: 'Deli' },
      { name: 'The Oaxacan Kitchen', cuisine: 'Mexican' },
      { name: 'The Waffle Roost', cuisine: 'American' },
      { name: 'Todos', cuisine: 'Mexican' },
      { name: 'Two Fish', cuisine: 'Poke/Bento' },
      { name: 'Underdogs Cantina', cuisine: 'Mexican' },
      { name: 'Urban Kitchen', cuisine: 'Salad' },
      { name: 'Voyager Foods', cuisine: 'American' },
      { name: 'WoKitchen', cuisine: 'Chinese' },
      { name: 'Yakitori Harue', cuisine: 'Japanese' }
    ];

    // Restaurant selector elements
    const restaurantSearch = document.getElementById('restaurantSearch');
    const cuisineFilter = document.getElementById('cuisineFilter');
    const restaurantList = document.getElementById('restaurantList');
    const restaurantValue = document.getElementById('restaurantValue');
    const restaurantCuisineValue = document.getElementById('restaurantCuisineValue');

    function populateCuisineFilter(){
      const cuisines = Array.from(new Set(approvedRestaurants.map(r=>r.cuisine))).sort();
      cuisines.forEach(c=>{
        const opt = document.createElement('option');
        opt.value = c;
        opt.textContent = c;
        cuisineFilter.appendChild(opt);
      });
    }

    function renderRestaurantOptions(){
      const term = (restaurantSearch?.value || '').toLowerCase().trim();
      const cuisine = cuisineFilter?.value || '';
      restaurantList.innerHTML = '';
      const matches = approvedRestaurants
        .filter(r => (!term || r.name.toLowerCase().includes(term)))
        .filter(r => (!cuisine || r.cuisine.toLowerCase().includes(cuisine.toLowerCase())));
      matches.forEach(r=>{
        const item = document.createElement('div');
        item.className = 'restaurant-item';
        item.setAttribute('role','option');
        item.setAttribute('tabindex','0');
        item.dataset.name = r.name;
        item.dataset.cuisine = r.cuisine;
        const left = document.createElement('div');
        left.className = 'restaurant-name';
        left.textContent = r.name;
        const right = document.createElement('div');
        right.className = 'restaurant-cuisine';
        right.textContent = r.cuisine;
        item.appendChild(left);
        item.appendChild(right);
        item.addEventListener('click', ()=> selectRestaurant(r.name, r.cuisine, item));
        item.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); selectRestaurant(r.name, r.cuisine, item);} });
        restaurantList.appendChild(item);
      });
    }

    function selectRestaurant(name, cuisine, itemEl){
      restaurantValue.value = name;
      restaurantCuisineValue.value = cuisine;
      [...restaurantList.children].forEach(el=>el.setAttribute('aria-selected','false'));
      if(itemEl){ itemEl.setAttribute('aria-selected','true'); }
    }

    function getSelectedRestaurant(){
      return { name: restaurantValue.value || '', cuisine: restaurantCuisineValue.value || '' };
    }

    // Initialize restaurant UI
    if(cuisineFilter && restaurantList){
      populateCuisineFilter();
      renderRestaurantOptions();
      restaurantSearch?.addEventListener('input', renderRestaurantOptions);
      cuisineFilter.addEventListener('change', renderRestaurantOptions);
    }

    function money(n){ if(isNaN(n) || !isFinite(n)) return '‚Äî'; return n.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0}); }

    function estimate(){
      const g = parseInt(guests.value,10) || 0;
      const per = parseFloat(budgetPer.value) || 0;
      const base = g * per;
      const rushFee = rush.checked ? 200 : 0;
      const total = (totalBudget.value ? parseFloat(totalBudget.value) : base) + rushFee;
      calcBase.textContent = base ? money(base) : '‚Äî';
      calcRush.textContent = rushFee ? money(rushFee) : '$0';
      calcTotal.textContent = total ? money(total) : '‚Äî';
    }
    ['input','change'].forEach(ev=>{
      [guests,budgetPer,totalBudget,rush].forEach(el=>el.addEventListener(ev,estimate));
    });
    estimate();

    // Time helpers for 15-min rounding and defaulting end time
    function toMinutes(t){
      const [hh, mm] = (t || '00:00').split(':').map(x=>parseInt(x,10)||0);
      return hh*60 + mm;
    }
    function toTimeStr(m){
      const hh = Math.floor((m% (24*60))/60);
      const mm = m % 60;
      const pad2 = n => String(n).padStart(2,'0');
      return `${pad2(hh)}:${pad2(mm)}`;
    }
    function roundTo15(t){
      const m = toMinutes(t);
      const rounded = Math.round(m / 15) * 15;
      return toTimeStr(rounded);
    }
    function clampEndAfterStart(){
      if(!startTime || !endTime) return;
      const s = startTime.value;
      if(!s) return;
      // If end is empty or earlier/equal, set to +60 mins from start, rounded to 15
      const sMin = toMinutes(s);
      const eMin = toMinutes(endTime.value || '');
      if(!endTime.dataset.userChanged || eMin <= sMin){
        const next = sMin + 60;
        endTime.value = roundTo15(toTimeStr(next));
        endTime.dataset.userChanged = '';
      }
    }

    if(startTime && endTime){
      // On load, round start and set default end
      if(startTime.value) startTime.value = roundTo15(startTime.value);
      clampEndAfterStart();
      startTime.addEventListener('change', ()=>{
        // Round to 15 and adjust end
        startTime.value = roundTo15(startTime.value);
        clampEndAfterStart();
      });
      endTime.addEventListener('change', ()=>{
        // User manually changed end time
        endTime.value = roundTo15(endTime.value);
        endTime.dataset.userChanged = '1';
      });
    }

    function serialize(){
      const data = new FormData(form);
      const mealTypes = $$('input[name="mealTypes"]:checked').map(x=>x.value);
      const pref = (data.get('menuPref')||'');
      const catType = (data.get('cateringType')||'');

      return {
        name: data.get('name'),
        email: data.get('email'),
        phone: data.get('phone'),
        company: data.get('company')||'',
        costCenter: data.get('costCenter')||'',
        eventDate: data.get('eventDate'),
        location: data.get('location'),
        startTime: data.get('startTime'),
        endTime: data.get('endTime'),
        guests: data.get('guests'),
        serviceStyle: data.get('serviceStyle'),
        mealTypes,
        menuPref: pref,
        menuNotes: data.get('menuNotes')||'',
        cateringType: catType,
        restaurant: getSelectedRestaurant().name,
        restaurantCuisine: getSelectedRestaurant().cuisine,
        budgetPer: data.get('budgetPer'),
        totalBudget: data.get('totalBudget')||'',
        rush: !!data.get('rush'),
        notes: data.get('notes')||''
      };
    }

    function validateTimes(){
      const s = $('#startTime').value;
      const e = $('#endTime').value;
      if(s && e && s >= e){
        alert('End time must be after start time.');
        return false;
      }
      return true;
    }

    function requiredFilled(){
      const requiredIds = ['name','email','phone','eventDate','location','startTime','endTime','guests','serviceStyle','budgetPer'];
      for(const id of requiredIds){
        const el = document.getElementById(id);
        if(!el.value){ el.focus(); el.scrollIntoView({behavior:'smooth',block:'center'}); return false; }
      }
      // At least one meal type
      if($$('input[name="mealTypes"]:checked').length === 0){
        alert('Select at least one meal type.');
        return false;
      }
      // Menu pref and catering type
      if(!document.querySelector('input[name="menuPref"]:checked')){ alert('Select a menu preference.'); return false; }
      if(!document.querySelector('input[name="cateringType"]:checked')){ alert('Select a catering type (Regular or VIP).'); return false; }
      return true;
    }

    function buildSummary(obj){
      const base = (parseInt(obj.guests||0,10) * parseFloat(obj.budgetPer||0))||0;
      const rushFee = obj.rush ? 200 : 0;
      const estTotal = (obj.totalBudget? parseFloat(obj.totalBudget): base) + rushFee;
      const restaurantLine = obj.restaurant ? `\nRestaurant: ${obj.restaurant} (${obj.restaurantCuisine || 'Cuisine n/a'})` : '';
      return `CATERING REQUEST\n\nCONTACT\nName: ${obj.name}\nEmail: ${obj.email}\nPhone: ${obj.phone}\nCompany: ${obj.company}\nCost Center: ${obj.costCenter}\n\nEVENT\nDate: ${obj.eventDate}\nLocation: ${obj.location}\nStart: ${obj.startTime}\nEnd: ${obj.endTime}\nGuests: ${obj.guests}\nService Style: ${obj.serviceStyle}\n\nMEALS\nTypes: ${obj.mealTypes.join(', ')}\nMenu Preference: ${obj.menuPref}${restaurantLine}\nMenu Notes: ${obj.menuNotes}\nCatering Type: ${obj.cateringType}\n\nBUDGET\nPer Person: $${Number(obj.budgetPer||0).toFixed(2)}\nTotal Budget (client): ${obj.totalBudget? `$${Number(obj.totalBudget).toFixed(2)}`:'(not specified)'}\nRush (within 48h): ${obj.rush? 'Yes (+$200)': 'No'}\n\nESTIMATE\nGuests √ó Per‚Äëperson: $${base.toFixed(2)}\nRush Fee: $${rushFee.toFixed(2)}\nEstimated Total: $${estTotal.toFixed(2)}\n\nNOTES\n${obj.notes || '(none)'}\n\n‚Äî Submitted via website`;
    }

    function openModal(summary){
      $('#previewText').textContent = summary;
      const dialog = $('#previewModal');
      if(typeof dialog.showModal === 'function') dialog.showModal(); else alert(summary);
    }
    function closeModal(){ $('#previewModal').close(); }

    function copySummary(){
      const txt = $('#previewText').textContent;
      navigator.clipboard.writeText(txt).then(()=>{
        alert('Summary copied to clipboard.');
      });
    }

    function buildMailto(summary){
      const to = 'Jarlein.Escobar@fooda.com'; // replace with your inbox
      const subject = encodeURIComponent('New Catering Request');
      const body = encodeURIComponent(summary);
      return `mailto:${to}?subject=${subject}&body=${body}`;
    }

    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      if(!requiredFilled() || !validateTimes()) return;
      const obj = serialize();
      const summary = buildSummary(obj);
      openModal(summary);
      const link = buildMailto(summary);
      const btn = $('#mailtoBtn');
      btn.onclick = ()=>{ window.location.href = link; };
    });

    $('#copyBtn').addEventListener('click', ()=>{
      if(!requiredFilled()) return;
      const summary = buildSummary(serialize());
      navigator.clipboard.writeText(summary).then(()=> alert('Summary copied.'));
    });

    $('#printBtn').addEventListener('click', ()=> window.print());
  </script>
</body>
</html>
